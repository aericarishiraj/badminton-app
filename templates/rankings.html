<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Badminton Player Rankings</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="/static/minimal.css">
</head>
<body>
    <a href="/" class="back-button">
        <i class="fas fa-arrow-left"></i> Back to Home
    </a>
    
    <div class="main-container">
        <div class="page-header">
            <h1><i class="fas fa-trophy"></i> Player Rankings</h1>
            <p class="lead">PageRank-based player rankings based on match outcomes</p>
        </div>
        
        <!-- Network Statistics -->
        <div class="stats-cards" id="statsCards">
            <div class="loading">
                <i class="fas fa-spinner"></i>
                <p>Loading statistics...</p>
            </div>
        </div>
        
        <!-- Rankings Table -->
        <div class="rankings-section">
            <h2><i class="fas fa-list-ol"></i> Player Rankings</h2>
            <div id="rankingsTable">
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Loading rankings...</p>
                </div>
            </div>
        </div>
        
        <!-- Network Visualization -->
        <div class="network-section">
            <h2><i class="fas fa-project-diagram"></i> Player Network</h2>
            <div class="alert alert-info mb-4" role="alert">
                <h5><i class="fas fa-info-circle"></i> Understanding the Network</h5>
                <div class="row">
                    <div class="col-md-6">
                        <strong>Nodes = Players</strong><br>
                        Each circle represents a player in the dataset.
                        <br><br>
                        <strong>Edges = Match outcomes</strong><br>
                        Connections via victories/losses between players.
                    </div>
                    <div class="col-md-6">
                        <strong>Cluster Tightness</strong> shows active participation and rivalry webs.
                        <br><br>
                        <strong>Peripheral nodes</strong> represent players with fewer matches or isolated records.
                    </div>
                </div>
            </div>
            <p class="lead">Network visualization showing player connections based on match outcomes</p>
            <div id="networkImage">
                <div class="loading">
                    <i class="fas fa-spinner"></i>
                    <p>Generating network visualization...</p>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        // Load rankings data
        async function loadRankings() {
            try {
                const response = await fetch('/player_rankings');
                const data = await response.json();
                
                // Update statistics cards
                const statsCards = document.getElementById('statsCards');
                statsCards.innerHTML = `
                    <div class="stat-card">
                        <h3>${data.network_stats.total_players}</h3>
                        <p><i class="fas fa-users"></i> Total Players</p>
                    </div>
                    <div class="stat-card">
                        <h3>${data.network_stats.total_matches}</h3>
                        <p><i class="fas fa-gamepad"></i> Total Matches</p>
                    </div>
                    <div class="stat-card">
                        <h3>${data.network_stats.avg_degree.toFixed(1)}</h3>
                        <p><i class="fas fa-chart-line"></i> Avg. Connections</p>
                    </div>
                    <div class="stat-card">
                        <h3>${data.rankings.length}</h3>
                        <p><i class="fas fa-medal"></i> Ranked Players</p>
                    </div>
                `;
                
                // Update rankings table
                const rankingsTable = document.getElementById('rankingsTable');
                let tableHTML = `
                    <div class="alert alert-info mb-4" role="alert">
                        <h5><i class="fas fa-info-circle"></i> Understanding the Rankings</h5>
                        <div class="row">
                            <div class="col-md-6">
                                <strong>PageRank Score:</strong> Reflects each player's influence in the competitive network. Beating high-ranked opponents increases your score more than beating low-ranked ones.
                                <br><br>
                                <strong>Win/Loss/Total Rallies:</strong> Gives transparency into the raw performance numbers.
                            </div>
                            <div class="col-md-6">
                                <strong>Win Rate Colors:</strong><br>
                                ðŸŸ¢ > 70%: Strong performers<br>
                                ðŸŸ  50â€“70%: Competitive<br>
                                ðŸ”´ < 50%: Underperforming
                                <br><br>
                                <strong>ðŸ’¡ Insight:</strong> A player like CHOU Tien Chen may have a lower win rate but still ranks high due to competing (and occasionally beating) other high-ranked players â€” showing that PageRank captures more than just totals.
                            </div>
                        </div>
                    </div>
                    <table class="rankings-table">
                        <thead>
                            <tr>
                                <th>Rank</th>
                                <th>Player</th>
                                <th>PageRank Score</th>
                                <th>Rallies Won</th>
                                <th>Rallies Lost</th>
                                <th>Total Rallies</th>
                                <th>Win Rate</th>
                            </tr>
                        </thead>
                        <tbody>
                `;
                
                data.rankings.forEach(player => {
                    const winRate = player.total_matches > 0 ? ((player.matches_won / player.total_matches) * 100).toFixed(1) : '0.0';
                    const rankClass = player.rank <= 3 ? `rank-${player.rank}` : 'rank-other';
                    
                    tableHTML += `
                        <tr>
                            <td><span class="rank-badge ${rankClass}">${player.rank}</span></td>
                            <td><strong>${player.player}</strong></td>
                            <td>${player.pagerank_score}</td>
                            <td><span class="text-success">${player.matches_won}</span></td>
                            <td><span class="text-danger">${player.matches_lost}</span></td>
                            <td>${player.total_matches}</td>
                            <td><span class="badge bg-${winRate >= 60 ? 'success' : winRate >= 40 ? 'warning' : 'danger'}">${winRate}%</span></td>
                        </tr>
                    `;
                });
                
                tableHTML += '</tbody></table>';
                rankingsTable.innerHTML = tableHTML;
                
            } catch (error) {
                console.error('Error loading rankings:', error);
                document.getElementById('rankingsTable').innerHTML = '<p class="text-danger">Error loading rankings data.</p>';
            }
        }
        
        // Load network visualization
        async function loadNetwork() {
            try {
                const response = await fetch('/player_network');
                const data = await response.json();
                
                const networkImage = document.getElementById('networkImage');
                networkImage.innerHTML = `
                    <img src="data:image/png;base64,${data.network_image}" 
                         alt="Player Network Visualization" 
                         class="network-image">
                `;
                
            } catch (error) {
                console.error('Error loading network:', error);
                document.getElementById('networkImage').innerHTML = '<p class="text-danger">Error loading network visualization.</p>';
            }
        }
        
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', function() {
            loadRankings();
            loadNetwork();
        });
    </script>
</body>
</html> 